#!/usr/bin/expect -f

# Setup test files  
exec echo "setting=initial" > /tmp/test-target.conf
exec echo "config_lines_to_manage:\n  - title: \"Test Setting\"\n    path: \"/tmp/test-target.conf\"\n    pattern: \"setting={{value}}\"\n    targetValue: \"initial\"\n    possibleValues: \[\"initial\", \"changed\", \"final\"\]" > /tmp/test-config.yaml

# Start application
spawn stack exec terminal-config-manager -- --config /tmp/test-config.yaml

# Wait for app startup (short timeout - fail fast)
set timeout 2
expect "navigate"

# Send quit command
send "q"

# Expect immediate exit (very short timeout - fail if app hangs)
set timeout 1
expect eof

# Only reached if all steps succeeded
exec rm -f /tmp/test-target.conf /tmp/test-config.yaml
puts "âœ“ SUCCESS: Application started and exited cleanly" 